default_platform(:ios)

platform :ios do
	desc "build_for_testing"
	lane :build_for_testing do |options|
		scan(
			scheme: "TinkoffEdu2021",
			clean: true,
			build_for_testing: true
		)
	end

	desc "run_tests"
	lane :run_tests_without_build do |options|
		scan(
			scheme: "TinkoffEdu2021",
			test_without_building: true
		)
	end

	desc "build_and_test"
	lane :build_and_test do |options|
		build_for_testing
		run_tests_without_build
		ds_notify_success
	end

	desc "Send build notification to Discord"
	lane :ds_notify_success do |options|
		discord_notifier(
		    webhook_url: ENV["DISCORD_HOOK"],
		    title: "Build Succed",
		    success: true
  		)
	end

	error do |lane, exception, options|
		discord_notifier(
		    webhook_url: ENV["DISCORD_HOOK"],
		    title: "Build Failed",
		    description: exception.to_s,
		    success: false
  		)
    end
end
